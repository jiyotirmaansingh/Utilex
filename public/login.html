<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Security-Policy"
  content="
    default-src 'self';

    script-src 
      'self'
      'unsafe-inline'
      'unsafe-eval'
      https://cdn.tailwindcss.com
      https://cdn.jsdelivr.net
      https://cdnjs.cloudflare.com
      https://cdn.socket.io
      https://cdn.jsdelivr.net/npm/sweetalert2@11
      https://kit.fontawesome.com;

    connect-src 
      'self'
      https://utilex.onrender.com
      wss://utilex.onrender.com
      https://api.github.com
      https://raw.githubusercontent.com;

    img-src 
      'self'
      data:
      blob:
      https://images.unsplash.com
      https://avatars.githubusercontent.com
      https://cdn.jsdelivr.net;

    style-src
      'self'
      'unsafe-inline'
      https://cdn.jsdelivr.net
      https://cdnjs.cloudflare.com;

    font-src
      'self'
      data:
      https://cdnjs.cloudflare.com
      https://cdn.jsdelivr.net;

    frame-ancestors 'self';

    base-uri 'self';
  ">

  <title>Login | Utilex.</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- SweetAlert -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    /* üå´Ô∏è Glassmorphic style */
    .glass {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border: 1px solid rgba(255, 255, 255, 0.15);
    }

    /* Smooth fade-in animation */
    .fade-in {
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.7s ease-out, transform 0.7s ease-out;
    }

    .fade-in.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* Placeholder text color */
    ::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }
  </style>
</head>

<body class="bg-[#000300] min-h-screen flex flex-col justify-center items-center text-gray-100 font-inter overflow-hidden">

  <!-- üîù Logo -->
  <a href="/index.html" class="absolute top-6 left-6 text-2xl font-bold text-green-400 hover:text-green-300 transition">
    Utilex.
  </a>

  <!-- üéØ Login Card -->
  <form id="loginForm"
    class="fade-in glass p-8 rounded-2xl shadow-2xl w-[90%] max-w-md space-y-5 border border-white/10">
    <h2 class="text-3xl font-semibold text-center text-green-400">Welcome Back</h2>

    <input required type="email" placeholder="Email" id="email"
      class="w-full px-4 py-3 bg-white/10 text-white border border-white/20 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 transition" />

    <input required type="password" placeholder="Password" id="password"
      class="w-full px-4 py-3 bg-white/10 text-white border border-white/20 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 transition" />

    <button type="submit"
      class="w-full bg-green-600 hover:bg-green-700 py-3 rounded-lg font-semibold text-white transition-all duration-300">
      Login
    </button>

    <p class="text-sm text-center text-gray-300">
      Don‚Äôt have an account?
      <a href="/register.html" class="text-green-400 hover:underline">Register</a>
    </p>

    <div class="text-center">
      <a href="/auth/github"
        class="inline-block bg-gray-800 hover:bg-gray-900 px-5 py-2.5 rounded-lg text-white font-medium transition-all duration-300">
        <svg class="w-5 h-5 inline-block mr-2 align-text-top" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M12 .297a12 12 0 00-3.797 23.408c.6.112.82-.258.82-.577v-2.17c-3.338.725-4.042-1.61-4.042-1.61a3.184 3.184 0 00-1.335-1.76c-1.09-.744.084-.729.084-.729a2.52 2.52 0 011.84 1.237 2.555 2.555 0 003.488 1 2.555 2.555 0 01.762-1.605c-2.665-.3-5.466-1.332-5.466-5.93a4.632 4.632 0 011.232-3.21 4.293 4.293 0 01.116-3.165s1.006-.322 3.3 1.23a11.415 11.415 0 016.006 0c2.292-1.552 3.296-1.23 3.296-1.23.435 1.078.456 2.303.114 3.165a4.63 4.63 0 011.232 3.21c0 4.61-2.805 5.626-5.478 5.92a2.85 2.85 0 01.814 2.212v3.285c0 .322.216.697.824.576A12.002 12.002 0 0012 .297" />
        </svg>
        Login with GitHub
      </a>
    </div>
  </form>

  <script>
    const BACKEND = "https://utilex.onrender.com";
  
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
  
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
  
      try {
        const res = await fetch(`${BACKEND}/api/user/login`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password }),
        });
  
        const data = await res.json().catch(() => ({}));
  
        if (res.ok) {
          localStorage.setItem("token", data.token);
          localStorage.setItem("name", data.name);
  
          Swal.fire({
            icon: 'success',
            title: 'Login Successful!',
            showConfirmButton: false,
            timer: 1200
          }).then(() => {
            // redirect to dashboard served from Vercel; frontend will read token from query or localStorage
            window.location.href = "/dashboard.html";
          });
        } else {
          Swal.fire({
            icon: 'error',
            title: 'Login Failed',
            text: data.message || "Invalid credentials"
          });
        }
      } catch (err) {
        console.error("Login error:", err);
        Swal.fire({
          icon: 'error',
          title: 'Server Error',
          text: 'Unable to connect. Please try again later.'
        });
      }
    });
  </script>
  
</body>

</html>
